
#include "omgui.h"
#include "screens.h"
#include "main.h"
#include "bitmaps.h"

#include "sh1122.h"
//#include "stm32l4xx_hal.h"
#include "tim.h"


omDisplayT oled1;
omScreenT screenLogo, screenMain, screenData, screenTemp, screenSetup;

static void DisplayInitCb(omDisplayT *);
static void DisplayUpdateCb(omDisplayT *);
static void DisplayDrawPixelCb(omDisplayT *, uint32_t x, uint32_t y, uint32_t color);


void OLED_GUI_Init(void)
{
  oled1.Id = 0;
  oled1.ResX = 256;
  oled1.ResY = 64;
  oled1.Screen = &screenMain;
  oled1.InitCallback = DisplayInitCb;
  oled1.DeInitCallback = NULL;
  oled1.UpdateCallback = DisplayUpdateCb;
  oled1.DrawPixelCallback = DisplayDrawPixelCb;

//  LogoScreenInit();
  MainScreenInit();

  omDisplayInit(&oled1);

  HAL_Delay(1000);

//  omScreenSelect(&screenMain);

/* This DOES NOT WORK: uint32_t image_data[] = { ... }
 * Array size is a MUST!
  * Gray_00 = BLACK
 * Gray_15 = WHITE
 */
uint32_t image_data[256] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xAA, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x77, 0x00, 0x00, 0xAA, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xEE, 0x77, 0x00, 0x00, 0x00, 0x77, 0xEE, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0xEE, 0xFF, 0xFF, 0xFF, 0xEE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xBB, 0xBB, 0x00, 0x00, 0x00, 0x00, 0xBB, 0xEE, 0xBB, 0x00, 0x00, 0x00, 0x00,
0x00, 0x88, 0xEE, 0xBB, 0xDD, 0xBB, 0x00, 0x00, 0xEE, 0xCC, 0x77, 0xEE, 0x77, 0x00, 0x00, 0x00,
0x00, 0x55, 0xAA, 0x00, 0xBB, 0xBB, 0x00, 0xBB, 0xBB, 0x00, 0x00, 0xBB, 0xBB, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0xEE, 0x77, 0xFF, 0xEE, 0xEE, 0x77, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEE, 0xFF, 0x00, 0x00, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0xBB, 0x00, 0x00, 0x00, 0x77, 0xEE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0xBB, 0xEE, 0xBB, 0xBB, 0xBB, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x77, 0xBB, 0xBB, 0xBB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

  omBitmapT bitmap_logo = {
    .Width = 16,
    .Height = 16,
    .ColorsNumOf = 16,
    .IsAlpha = False,
    .RawData = &image_data[0],
    .Display = &oled1
  };

  omDrawBitmap(&oled1, &bitmap_logo, 16, 6);
  omDisplayUpdate(&oled1);
}


static void DisplayInitCb(omDisplayT *displ)
{
  Display_Init();
  // Show logo
  omDrawBitmap(displ, &bitmap_logo, 256, 64);
  omDisplayUpdate(displ);
  Sleep(1000);
  return;
}


static void DisplayUpdateCb(omDisplayT *displ)
{
  Display_SendFrame();
}


static void DisplayDrawPixelCb(omDisplayT *displ, uint32_t x, uint32_t y, uint32_t color)
{
  Frame_DrawPixel(x, y, color);
  return;
}
